<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HousePrice AI | ML Web App</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<div class="glass-card">

    <h1>üè† HousePrice AI</h1>
    <p>End-to-End Machine Learning Web Application</p>

    <!-- ERROR MESSAGE -->
    <div id="errorBox" class="error-box">
        ‚ö† Invalid Input! Please enter realistic values.
    </div>

    <!-- ================= FORM ================= -->
    <form method="POST" id="predictionForm">

        <!-- PROPERTY DETAILS -->
        <div class="section">
            <h2 class="section-title">üè° Property Details</h2>

            <div class="slider-grid">

                {% for col in columns %}

                {% if col == "area" %}
                <div class="slider-box">
                    <label>Total Area (sq ft)</label>
                    <input type="range"
       min="200"
       max="10000"
       step="50"
       value="200"
       name="area"
       oninput="updateValue('areaVal', this.value)">
<span id="areaVal">200</span>
                </div>

                {% elif col == "bedrooms" %}
                <div class="slider-box">
                    <label>Bedrooms</label>
                    <input type="range"
       min="1"
       max="10"
       value="1"
       name="bedrooms"
       oninput="updateValue('bedVal', this.value)">
<span id="bedVal">1</span>
                </div>

                {% elif col == "bathrooms" %}
                <div class="slider-box">
                    <label>Bathrooms</label>
                    <input type="range"
       min="1"
       max="10"
       value="1"
       name="bathrooms"
       oninput="updateValue('bathVal', this.value)">
<span id="bathVal">1</span>
                </div>

                {% elif col == "stories" %}
                <div class="slider-box">
                    <label>Floors</label>
                    <input type="range"
       min="1"
       max="4"
       value="1"
       name="stories"
       oninput="updateValue('storyVal', this.value)">
<span id="storyVal">1</span>
                </div>

                {% elif col == "parking" %}
                <div class="slider-box">
                    <label>Parking Spaces</label>
                    <input type="range"
       min="0"
       max="5"
       value="0"
       name="parking"
       oninput="updateValue('parkVal', this.value)">
<span id="parkVal">0</span>
                </div>
                {% endif %}

                {% endfor %}

            </div>
        </div>


        <!-- PROPERTY FEATURES -->
        <div class="section">
            <h2 class="section-title">‚ú® Property Features</h2>

            <div class="feature-grid">

                {% for col in columns %}
                {% if col not in ["area","bedrooms","bathrooms","stories","parking"] %}

                <div class="toggle-box">
                    <label>{{ col.replace("_"," ").title() }}</label>
                    <select name="{{ col }}">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>

                {% endif %}
                {% endfor %}

            </div>
        </div>

        <button type="submit" class="predict-btn">Predict Price</button>

    </form>

    <!-- ================= PREDICTION RESULT ================= -->
    {% if prediction %}
    <div class="result">
        <h2>Predicted Price</h2>
        <h3>‚Çπ {{ prediction }}</h3>
    </div>
    {% endif %}


    <!-- ================= MODEL METRICS ================= -->
    {% if metrics %}
    <div class="metrics">
        <h2>üìä Model Comparison</h2>

        <div class="metric-grid">
            {% for model_name, values in metrics.items() %}
            <div class="metric-card">
                <h3>{{ model_name }}</h3>
                <p><strong>R¬≤:</strong> {{ values.R2 }}</p>
                <p><strong>RMSE:</strong> {{ values.RMSE }}</p>
                <p><strong>CrossVal R¬≤:</strong> {{ values.CrossVal_R2 }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}


    <!-- ================= FEATURE IMPORTANCE CHART ================= -->
    {% if feature_importance %}
    <div class="chart-section">
        <h2>üîé Feature Importance (Random Forest)</h2>
        <canvas id="importanceChart"></canvas>
    </div>

    <script>
        const labels = {{ feature_names | tojson }};
        const dataValues = {{ feature_importance | tojson }};

        new Chart(document.getElementById('importanceChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Importance',
                    data: dataValues,
                    backgroundColor: '#f43f5e',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                animation: { duration: 2000 },
                scales: {
                    x: { ticks: { color: '#333' }},
                    y: { ticks: { color: '#333' }}
                }
            }
        });
    </script>
    {% endif %}

</div>


<!-- ================= JAVASCRIPT ================= -->
<script>

function updateValue(id, value) {
    document.getElementById(id).innerText = value;
}

document.getElementById("predictionForm").addEventListener("submit", function(event) {

    let inputs = this.querySelectorAll("input[type='range'], select");
    let valid = false;

    inputs.forEach(input => {
        if (parseFloat(input.value) > 0) {
            valid = true;
        }
    });

    if (!valid) {
        event.preventDefault();
        document.getElementById("errorBox").style.display = "block";
    }

});

</script>

</body>
</html>
